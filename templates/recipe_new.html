<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>レシピ登録</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                         "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
            max-width: 520px;
            margin: 0 auto;
            padding: 10px 12px 28px;
            line-height: 1.8;
            background-color: #ffffff;
        }
        h1 {
            font-size: 1.4rem;
            margin: 8px 0 6px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-size: 1.0rem;
        }
        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 6px 8px;
            font-size: 1.0rem;
        }
        fieldset {
            margin-bottom: 12px;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        legend {
            font-size: 1.0rem;
            font-weight: bold;
        }
        button {
            padding: 10px 16px;
            font-size: 1.0rem;
            border-radius: 6px;
            border: none;
            background-color: #4b7bec;
            color: #fff;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            opacity: 0.9;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        .login-info {
            font-size: 0.9rem;
        }
        .flash {
            color: #c00;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        .small-note {
            font-size: 0.8rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <h1>レシピ登録</h1>
        <div class="login-info">
            {% with messages = get_flashed_messages() %}
              {% if messages %}
                {% for message in messages %}
                  <div class="flash">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            {% if nickname %}
                ログイン中: {{ nickname }}
            {% endif %}
            <div>
                <a href="{{ url_for('index') }}">条件入力に戻る</a>
            </div>
        </div>
    </div>

    <form method="POST" action="{{ url_for('recipe_new') }}">
        <label>
            レシピ名：
            <input type="text" name="name" required>
        </label>

        <fieldset>
            <legend>食事タイミング</legend>
            <label><input type="checkbox" name="meal_type" value="breakfast"> 朝食</label>
            <label><input type="checkbox" name="meal_type" value="lunch"> 昼食</label>
            <label><input type="checkbox" name="meal_type" value="dinner" checked> 夕食</label>
        </fieldset>

        <fieldset>
            <legend>料理の種類</legend>
            <label><input type="radio" name="role" value="main" checked> メイン</label>
            <label><input type="radio" name="role" value="side"> 副菜</label>
        </fieldset>

        <fieldset>
            <legend>材料</legend>
            <label>
                材料（カンマ区切り）：
                <textarea name="ingredients" rows="3" placeholder="例：鮭切り身, 塩"></textarea>
            </label>
        </fieldset>

        <fieldset>
            <legend>アレルギー</legend>
            <span class="small-note">該当するものにチェック：</span>
            <label><input type="checkbox" name="allergy_flags" value="卵"> 卵</label>
            <label><input type="checkbox" name="allergy_flags" value="乳"> 乳</label>
            <label><input type="checkbox" name="allergy_flags" value="小麦"> 小麦</label>
            <label><input type="checkbox" name="allergy_flags" value="魚"> 魚</label>
            <label><input type="checkbox" name="allergy_flags" value="大豆"> 大豆</label>
        </fieldset>

        <fieldset>
            <legend>季節</legend>
            <label>
                対応する月（カンマ区切り・未入力なら通年）：
                <input type="text" name="months" placeholder="例：1,2,3">
            </label>
        </fieldset>

        <fieldset>
            <legend>栄養（1人前あたり）</legend>
            <label>
                エネルギー（kcal）：
                <input type="number" step="0.1" name="kcal" placeholder="例：400">
            </label>
            <label>
                たんぱく質（g）：
                <input type="number" step="0.1" name="protein" placeholder="例：15.0">
            </label>
            <label>
                脂質（g）：
                <input type="number" step="0.1" name="fat" placeholder="例：10.0">
            </label>
            <label>
                炭水化物（g）：
                <input type="number" step="0.1" name="carbs" placeholder="例：50.0">
            </label>
            <div class="small-note">
                ※ 栄養を入力すると、自動献立の「1日ごとの栄養トータル」に反映されます。
            </div>
        </fieldset>

        <button type="submit">レシピを登録する</button>
    </form>
</body>
</html>
